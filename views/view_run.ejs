<%

	var req_path = req.path;
	
	var task = {};
	sails.config.tasks.forEach(function(t){
		if(t.config.slug==req.params.slug)
			task = t;
	})
	var folder_path=task.path.replace('api/tasks/','').replace('/'+task.file,'').split('/');

%>
<div class='ui basic segment container'>

	<div class="ui breadcrumb">
		<a class="section" href='/library'>Library</a>
		<% var path = '/library'%>
		<%folder_path.forEach(function(folder){%>
		<% path +='/'+folder%>
		<i class="right angle icon divider"></i>
		<a class="section" href='<%=path%>'><%=folder%></a>
		<%})%>
		<i class="right angle icon divider"></i>
		<a class="section" href='/task/<%=req.params.slug%>'><%=task.config.name%></a>
		<i class="right angle icon divider"></i>
		<div class="section"><%=run.id%></div> 
	</div>
	<h1 style='margin-top:0;'>
		<span style='opacity: 0.5;'>Task Run: </span><span data-content="<%=task.config.name%>"><%= task.config?.name?.length > 47 ? task.config?.name?.substring(0, 47) + '...' : task.config.name %> #<%=run.id%></span>
		
		<div class="ui compact basic icon button right floated dropdown">
			<i class="middle aligned ellipsis vertical icon" style="margin-left: 4px;"></i>
			<div class="menu" style="margin-top: 4px;">
				<div class="item" id="edit_modal">
					<i class="edit icon"></i> Edit
				</div>
			</div>
		</div>
		<a class="ui compact basic button right floated" href='' target='_blank'>
			<i class="file icon"></i> 
			Run again ...
		</a>
		
	</h1>
	<table class="ui celled unstackable collapsing compact table">
	    <tbody>
	    	<tr>
	    	    <td><b>Status</b></td>
	    	    <td><b>Duration</b></td>
	    	</tr>
	        <tr>
	            <td><%=run.status%></td>
	            <td><%=run.duration%>s</td>
	        </tr>
	    </tbody>
	</table>
	<div class="ui divider"></div>

	<h3>Logs:</h3>
	<!-- <%run.logs.forEach(function(log){%>
        <span style="color: #aaaaaa;"><%=log.timestamp%>:</span> <%=log.text%><br>
    <%})%> -->
	<div class='ui segment'>
		
	
	<table class="ui very basic compact unstackable table">
	    <tbody>
			<%run.logs.forEach(function(log){%>
	        <tr>
	            <td class='single line top aligned'><%=log.timestamp.substring(11,19)%></td>
	            <td><pre style="margin: 0px;"><%=log.text%></pre></td>
	        </tr>
	        <%})%>
	    </tbody>
	</table> 
	</div>
</div>
